<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TXT搜索替换工具</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="node_modules/monaco-editor/min/vs/editor/editor.main.css">
</head>
<body>
  <div class="app-container">
    <!-- 顶部工具栏 -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="neumorphic-btn" id="openFileBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
          </svg>
          打开文件
        </button>
        <button class="neumorphic-btn" id="saveFileBtn" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          保存
        </button>
        <button class="neumorphic-btn" id="saveAsBtn" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          另存为
        </button>
      </div>
      <div class="toolbar-center">
        <span class="file-path" id="filePath">未打开文件</span>
      </div>
    </div>

    <!-- 搜索替换面板 -->
    <div class="search-panel">
      <div class="search-row">
        <div class="input-group">
          <label>搜索:</label>
          <input type="text" class="neumorphic-input" id="searchInput" placeholder="输入搜索关键字">
        </div>
        <button class="neumorphic-btn primary" id="searchBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          搜索
        </button>
        <button class="neumorphic-btn danger" id="stopSearchBtn" style="display: none;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="6" y="6" width="12" height="12" rx="2"></rect>
          </svg>
          停止搜索
        </button>
      </div>
      <div class="search-row">
        <div class="input-group">
          <label>替换:</label>
          <input type="text" class="neumorphic-input" id="replaceInput" placeholder="输入替换文本">
        </div>
        <button class="neumorphic-btn primary" id="replaceAllBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"></polyline>
            <polyline points="23 20 23 14 17 14"></polyline>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
          </svg>
          一键替换全部
        </button>
        <button class="neumorphic-btn" id="compareBtn" disabled>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
          内容映射
        </button>
      </div>
      <div class="search-info">
        <span id="searchInfo">未搜索</span>
      </div>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
      <!-- Monaco编辑器容器 -->
      <div class="editor-container">
        <div id="editor"></div>
      </div>
    </div>
  </div>

  <!-- 内容映射侧边栏 -->
  <div class="comparison-sidebar" id="comparisonSidebar">
    <div class="sidebar-header">
      <h3>内容映射记录</h3>
      <button class="close-btn" id="closeSidebar">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="sidebar-body">
      <div class="comparison-summary">
        <p>已替换 <span class="count-badge" id="compareCount">0</span> 处</p>
        <p class="compare-text">
          <span class="old-text" id="compareOldText"></span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 8px;">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
          <span class="new-text" id="compareNewText"></span>
        </p>
      </div>
      <div class="comparison-list" id="comparisonList"></div>
    </div>
    <!-- 映射记录只用于查看和快速填充 -->
  </div>

  <!-- 搜索结果弹窗 -->
  <div class="modal" id="resultsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>搜索结果</h3>
        <div style="display: flex; align-items: center; gap: 8px;">
          <button class="icon-btn" id="secondaryFilterBtn" title="二次过滤（批量忽略匹配项） - 快捷键: Ctrl+F">

            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
          <button class="close-btn" id="closeModal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
      <div class="modal-body">
        <div class="results-summary">
          找到 <span id="resultCount">0</span> 个匹配项 | 
          已替换 <span id="replacedCount">0</span> 个 | 
          已忽略 <span id="ignoredCount">0</span> 个
          <span id="queueInfo" style="margin-left: 12px; color: #4299e1; display: none;">
            | 队列中还有 <span id="queueCount">0</span> 个待渲染
          </span>
        </div>
        <div class="results-list" id="resultsList"></div>
      </div>
      <div class="modal-footer">
        <button class="neumorphic-btn" id="backToEditor">返回编辑器</button>
      </div>
    </div>
  </div>

  <!-- 段落详情弹窗 -->
  <div class="modal" id="paragraphModal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3>段落详情</h3>
        <button class="close-btn" id="closeParagraphModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="paragraph-container">
          <div class="paragraph-section">
            <div class="paragraph-label">上一个段落</div>
            <div class="paragraph-content" id="prevParagraph">无上一个段落</div>
          </div>
          <div class="paragraph-section current">
            <div class="paragraph-label">当前段落</div>
            <div class="paragraph-content" id="currentParagraph"></div>
          </div>
          <div class="paragraph-section">
            <div class="paragraph-label">下一个段落</div>
            <div class="paragraph-content" id="nextParagraph">无下一个段落</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 自定义Alert弹窗 -->
  <div class="modal" id="customAlertModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="alertTitle">提示</h3>
        <button class="close-btn" id="closeAlertModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <p id="alertMessage" style="font-size: 15px; line-height: 1.6; color: var(--text-dark);"></p>
      </div>
      <div class="modal-footer">
        <button class="neumorphic-btn primary" id="alertConfirmBtn">确定</button>
      </div>
    </div>
  </div>

  <!-- 自定义Confirm弹窗 -->
  <div class="modal" id="customConfirmModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="confirmTitle">确认</h3>
        <button class="close-btn" id="closeConfirmModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <p id="confirmMessage" style="font-size: 15px; line-height: 1.6; color: var(--text-dark); white-space: pre-wrap;"></p>
      </div>
      <div class="modal-footer" style="gap: 12px;">
        <button class="neumorphic-btn" id="confirmCancelBtn">取消</button>
        <button class="neumorphic-btn primary" id="confirmOkBtn">确定</button>
      </div>
    </div>
  </div>

  <!-- 自定义Prompt弹窗（输入对话框） -->
  <div class="modal" id="customPromptModal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3 id="promptTitle">输入</h3>
        <button class="close-btn" id="closePromptModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="padding: 24px;">
        <p id="promptMessage" style="font-size: 15px; line-height: 1.6; color: var(--text-dark); white-space: pre-wrap; margin-bottom: 16px;"></p>
        <input type="text" class="neumorphic-input" id="promptInput" placeholder="请输入内容" style="width: 100%; padding: 12px; font-size: 14px;">
      </div>
      <div class="modal-footer" style="gap: 12px;">
        <button class="neumorphic-btn" id="promptCancelBtn">取消</button>
        <button class="neumorphic-btn primary" id="promptOkBtn">确定</button>
      </div>
    </div>
  </div>

  <!-- 加载 Monaco Editor -->
  <script src="node_modules/monaco-editor/min/vs/loader.js"></script>
  <!-- 加载主渲染进程脚本 -->
  <script src="renderer.js"></script>
</body>
</html>
